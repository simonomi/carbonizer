name: Build carbonizer

on: [push]

permissions:
  contents: write

jobs:
  build-macos:
    runs-on: macos-latest
    steps:
    - name: Set up Swift
      uses: SwiftyLab/setup-swift@latest
      with:
        swift-version: "5.10"
    - name: Checkout
      uses: actions/checkout@v4
    - name: Build
      run: swift build -Xswiftc -DIN_CI
    - name: Test
      run: swift test -Xswiftc -DIN_CI
    - name: Release
      uses: softprops/action-gh-release@v2
      # if: startsWith(github.ref, 'refs/tags/')
      with:
        draft: true
        files: /Users/runner/work/carbonizer/carbonizer/.build/*/debug/carbonizer
  
  build-windows:
    runs-on: windows-latest
    steps:
    - name: Set up Swift
      uses: SwiftyLab/setup-swift@latest
      with:
        swift-version: "5.10"
    - name: Checkout
      uses: actions/checkout@v4
    - name: Build
      run: swift build -Xswiftc -DIN_CI
    - name: Test
      run: swift test -Xswiftc -DIN_CI
    - name: Release
      uses: softprops/action-gh-release@v2
      # if: startsWith(github.ref, 'refs/tags/')
      with:
        draft: true
        files: D:/a/carbonizer/carbonizer/.build/*/debug/carbonizer.exe
